<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Marketing Form</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f5f7fa;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }
    .form-container {
      background: white;
      padding: 2rem;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      width: 100%;
      max-width: 400px;
    }
    label {
      display: block;
      margin-top: 1rem;
    }
    input, button {
      width: 100%;
      padding: 0.75rem;
      margin-top: 0.5rem;
      box-sizing: border-box;
    }
    button {
      background-color: #007BFF;
      color: white;
      border: none;
      cursor: pointer;
      font-weight: bold;
    }
    button:hover {
      background-color: #0056b3;
    }
  </style>
</head>
<body>
  <div class="form-container">
    <h2>Subscribe</h2>
    <form id="formMarketing" name="marketing">
      <input type="hidden" name="_captcha" value="false">
      <input type="hidden" name="_next" value="https://aquamarine-dolphin-13fd0f.netlify.app/thanks.html">

      <label for="firstName">First Name</label>
      <input type="text" name="firstName" id="firstName" required>

      <label for="lastName">Last Name</label>
      <input type="text" name="lastName" id="lastName" required>

      <label for="email">Email</label>
      <input type="email" name="email" id="email" required>

      <label>
        <input type="checkbox" name="marketingConsent" id="marketingConsent" value="checked" required>
        I agree to receive marketing information
      </label>

      <button type="submit">Subscribe</button>
    </form>
  </div>

  <!-- Securiti Consent SDK -->
  <script src="https://cdn-prod.securiti.ai/consent/form-consent-sdk.js"></script>
  <script>
    window.addEventListener('load', function () {
      const form = document.getElementById("formMarketing");

      FormConsentSDK.initialize({
        codeGenMetadata: {
          formPropertyId: "3",
          formSelector: "[name=\"marketing\"]",
          subjectIdentifiers: [
            { name: "First Name", selector: "[name=\"firstName\"]", isPrimary: false },
            { name: "Last Name", selector: "[name=\"lastName\"]", isPrimary: false },
            { name: "Email", selector: "[name=\"email\"]", isPrimary: true }
          ],
          consentIdentifiers: [
            {
              type: "checkbox",
              name: "marketingConsent",
              selector: "[name=\"marketingConsent\"]",
              propertyId: 8609,
              consentValue: "checked"
            }
          ],
          consentTrigger: {
            action: "submit" // üî• sem selector vazio aqui!
          }
        },
        url: 'https://app.securiti.ai/privaci/v1/',
        authToken: '139d71cf-2f03-42ef-a77a-050028cc390a',
        orgId: '1',
        onConsentSuccess: function () {
          console.log("‚úÖ Consentimento OK, enviando para Formsubmit");
          form.setAttribute("action", "https://formsubmit.co/walter.bertelli@gmail.com");
          form.setAttribute("method", "POST");
          form.submit();
        },
        onConsentFailure: function (err) {
          console.error("‚ùå Consentimento falhou:", err);
          alert("Erro ao registrar consentimento.");
        }
      });

      // Intercepta o submit padr√£o e deixa o SDK cuidar
      form.addEventListener("submit", function (e) {
        e.preventDefault();
        FormConsentSDK.submit();
      });
    });
  </script>
</body>
</html>
